<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký người dùng mới - Hệ thống nhận diện khuôn mặt</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>Đăng ký người dùng mới</h1>
        
        <div class="control-panel">
            <button id="startButton">Bắt đầu Camera</button>
            <button id="stopButton" disabled>Dừng Camera</button>
            <button id="captureButton" disabled>Chụp ảnh</button>
            
            <select id="cameraSelect">
                <option value="0">Camera mặc định</option>
            </select>
            
            <a href="index.html" class="back-link">Quay lại trang chủ</a>
        </div>
        
        <div class="register-container">
            <div class="webcam-container">
                <video id="webcam" autoplay playsinline></video>
                <canvas id="canvas" style="display: none;"></canvas>
                <img id="capturedImage" style="display: none;">
            </div>
            
            <div class="register-form">
                <h2>Thông tin người dùng</h2>
                <form id="registrationForm">
                    <div class="form-group">
                        <label for="userId">ID người dùng:</label>
                        <input type="text" id="userId" name="userId" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="name">Họ và tên:</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Số điện thoại:</label>
                        <input type="tel" id="phone" name="phone">
                    </div>
                    
                    <div class="form-group">
                        <label for="position">Vị trí:</label>
                        <input type="text" id="position" name="position">
                    </div>
                    
                    <div class="form-group">
                        <label for="department">Phòng ban:</label>
                        <input type="text" id="department" name="department">
                    </div>
                    
                    <button type="submit" id="registerButton" disabled>Đăng ký</button>
                </form>
                
                <div id="message"></div>
            </div>
        </div>
    </div>
    
    <script src="js/webcam.js"></script>
    <script>
        // Script xử lý đăng ký
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('registrationForm');
            const registerButton = document.getElementById('registerButton');
            const messageDiv = document.getElementById('message');
            const capturedImage = document.getElementById('capturedImage');
            let imageCapture = null;
            
            // Sự kiện khi chụp ảnh thành công
            window.addEventListener('imageCaptured', function(e) {
                imageCapture = e.detail.image;
                capturedImage.src = imageCapture;
                capturedImage.style.display = 'block';
                registerButton.disabled = false;
            });
            
            // Xử lý submit form
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!imageCapture) {
                    messageDiv.textContent = 'Vui lòng chụp ảnh khuôn mặt trước';
                    messageDiv.className = 'error';
                    return;
                }
                
                // Thu thập dữ liệu form
                const userData = {
                    user_id: document.getElementById('userId').value,
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value || '',
                    phone: document.getElementById('phone').value || '',
                    position: document.getElementById('position').value || '',
                    department: document.getElementById('department').value || '',
                    image: imageCapture
                };
                
                // Gửi dữ liệu đến API
                fetch('http://localhost:5000/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        messageDiv.textContent = data.message || 'Đăng ký thành công!';
                        messageDiv.className = 'success';
                        form.reset();
                        capturedImage.style.display = 'none';
                        registerButton.disabled = true;
                    } else {
                        messageDiv.textContent = data.error || 'Có lỗi xảy ra, vui lòng thử lại.';
                        messageDiv.className = 'error';
                    }
                })
                .catch(err => {
                    messageDiv.textContent = 'Lỗi kết nối: ' + err.message;
                    messageDiv.className = 'error';
                });
            });
        });
    </script>
</body>
</html>